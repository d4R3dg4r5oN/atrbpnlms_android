(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{NNBU:function(i,t,n){"use strict";n.r(t),n.d(t,"AddonNotificationsListPageModule",(function(){return j}));var o=n("tyNb"),e=n("L3Fv"),a=n("mrSG"),c=n("3LXp"),r=n("bFG1"),s=n("fjkH"),d=n("yjU1"),l=n("pHTc"),_=n("46ml"),f=n("baaQ"),g=n("2eZG"),m=n("9+EE"),p=n("YyYz"),u=n("Q98t"),h=n("VUQF"),b=n("EoRH"),P=n("fXoL"),A=n("TEn/"),v=n("C1x5"),N=n("nt/U"),M=n("PgjG"),O=n("ofXK"),x=n("xpMl"),C=n("3jOR"),w=n("hMzs"),k=n("FeAf"),L=n("eAud"),y=n("3CSS"),E=n("r8G5"),T=n("sYmb"),V=n("lAaw");function AddonNotificationsListPage_ion_item_17_core_user_avatar_2_div_1_Template(i,t){if(1&i&&(P.Ec(0,"div",20),P.zc(1,"img",21),P.Dc()),2&i){const i=P.Oc(2).$implicit;P.lc(1),P.Vc("src",i.iconurl,P.id)}}function AddonNotificationsListPage_ion_item_17_core_user_avatar_2_core_mod_icon_2_Template(i,t){if(1&i&&P.zc(0,"core-mod-icon",22),2&i){const i=P.Oc(2).$implicit;P.Vc("modicon",i.iconurl)("modname",i.modname)("showAlt",!1)}}function AddonNotificationsListPage_ion_item_17_core_user_avatar_2_Template(i,t){if(1&i&&(P.Ec(0,"core-user-avatar",17),P.nd(1,AddonNotificationsListPage_ion_item_17_core_user_avatar_2_div_1_Template,2,1,"div",18),P.nd(2,AddonNotificationsListPage_ion_item_17_core_user_avatar_2_core_mod_icon_2_Template,1,3,"core-mod-icon",19),P.Dc()),2&i){const i=P.Oc().$implicit;P.Vc("user",i)("profileUrl",i.profileimageurlfrom)("fullname",i.userfromfullname)("userId",i.useridfrom),P.lc(1),P.Vc("ngIf",i.iconurl&&!i.modname),P.lc(1),P.Vc("ngIf",i.modname)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_div_1_Template(i,t){if(1&i&&(P.Ec(0,"div",25),P.zc(1,"img",21),P.Dc()),2&i){const i=P.Oc(2).$implicit;P.lc(1),P.Vc("src",i.iconurl,P.id)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_core_mod_icon_2_Template(i,t){if(1&i&&P.zc(0,"core-mod-icon",26),2&i){const i=P.Oc(2).$implicit;P.Vc("modicon",i.iconurl)("modname",i.modname)("showAlt",!1)}}function AddonNotificationsListPage_ion_item_17_ng_container_3_Template(i,t){if(1&i&&(P.Cc(0),P.nd(1,AddonNotificationsListPage_ion_item_17_ng_container_3_div_1_Template,2,1,"div",23),P.nd(2,AddonNotificationsListPage_ion_item_17_ng_container_3_core_mod_icon_2_Template,1,3,"core-mod-icon",24),P.Bc()),2&i){const i=P.Oc().$implicit;P.lc(1),P.Vc("ngIf",!i.modname),P.lc(1),P.Vc("ngIf",i.modname)}}function AddonNotificationsListPage_ion_item_17_ng_container_10_Template(i,t){if(1&i&&(P.Cc(0),P.pd(1),P.Bc()),2&i){const i=P.Oc().$implicit;P.lc(1),P.rd(" · ",i.userfromfullname,"")}}function AddonNotificationsListPage_ion_item_17_ion_note_11_Template(i,t){1&i&&(P.Ec(0,"ion-note",2),P.zc(1,"ion-icon",27),P.Dc())}const _c0=function(i){return{$a:i}};function AddonNotificationsListPage_ion_item_17_Template(i,t){if(1&i){const i=P.Fc();P.Ec(0,"ion-item",11),P.Mc("click",(function AddonNotificationsListPage_ion_item_17_Template_ion_item_click_0_listener(){P.fd(i);const n=t.$implicit;return P.Oc().notifications.select(n)})),P.Pc(1,"translate"),P.nd(2,AddonNotificationsListPage_ion_item_17_core_user_avatar_2_Template,3,6,"core-user-avatar",12),P.nd(3,AddonNotificationsListPage_ion_item_17_ng_container_3_Template,3,2,"ng-container",13),P.Ec(4,"ion-label"),P.Ec(5,"p",14),P.zc(6,"core-format-text",15),P.Dc(),P.Ec(7,"p"),P.pd(8),P.Pc(9,"coreTimeAgo"),P.nd(10,AddonNotificationsListPage_ion_item_17_ng_container_10_Template,2,1,"ng-container",13),P.Dc(),P.Dc(),P.nd(11,AddonNotificationsListPage_ion_item_17_ion_note_11_Template,2,0,"ion-note",16),P.Dc()}if(2&i){const i=t.$implicit,n=P.Oc();P.Vc("detail",!1),P.mc("aria-current",n.notifications.getItemAriaCurrent(i))("aria-label",i.timeread?i.subject:P.Rc(1,11,"addon.notifications.unreadnotification",P.ad(16,_c0,i.subject))),P.lc(2),P.Vc("ngIf",i.useridfrom>0),P.lc(1),P.Vc("ngIf",i.useridfrom<=0&&i.iconurl),P.lc(3),P.Vc("text",i.subject)("contextInstanceId",0)("wsNotFiltered",!0),P.lc(2),P.qd(P.Qc(9,14,i.timecreated)),P.lc(2),P.Vc("ngIf",i.useridfrom>0),P.lc(1),P.Vc("ngIf",!i.timeread)}}function AddonNotificationsListPage_core_empty_box_18_Template(i,t){1&i&&(P.zc(0,"core-empty-box",28),P.Pc(1,"translate")),2&i&&P.Vc("message",P.Qc(1,1,"addon.notifications.therearentnotificationsyet"))}function AddonNotificationsListPage_ion_chip_21_ion_icon_1_Template(i,t){1&i&&P.zc(0,"ion-icon",31)}function AddonNotificationsListPage_ion_chip_21_ion_spinner_2_Template(i,t){1&i&&(P.zc(0,"ion-spinner"),P.Pc(1,"translate")),2&i&&P.mc("aria-label",P.Qc(1,1,"core.loading"))}function AddonNotificationsListPage_ion_chip_21_Template(i,t){if(1&i){const i=P.Fc();P.Ec(0,"ion-chip",29),P.Mc("click",(function AddonNotificationsListPage_ion_chip_21_Template_ion_chip_click_0_listener(){P.fd(i);return P.Oc().markAllNotificationsAsRead()})),P.nd(1,AddonNotificationsListPage_ion_chip_21_ion_icon_1_Template,1,0,"ion-icon",30),P.nd(2,AddonNotificationsListPage_ion_chip_21_ion_spinner_2_Template,2,3,"ion-spinner",13),P.pd(3),P.Pc(4,"translate"),P.Dc()}if(2&i){const i=P.Oc();P.Vc("disabled",i.loadingMarkAllNotificationsAsRead),P.lc(1),P.Vc("ngIf",!i.loadingMarkAllNotificationsAsRead),P.lc(1),P.Vc("ngIf",i.loadingMarkAllNotificationsAsRead),P.lc(1),P.rd(" ",P.Qc(4,4,"addon.notifications.markallread")," ")}}let I=(()=>{class AddonNotificationsListPage{constructor(){this.fetchMoreNotificationsFailed=!1,this.canMarkAllNotificationsAsRead=!1,this.loadingMarkAllNotificationsAsRead=!1,this.pendingRefresh=!1;try{const i=f.a.getOrCreateSource(h.a,[]);this.notifications=new b.a(i,AddonNotificationsListPage)}catch(i){c.a.showErrorModal(i),l.a.back()}}ngAfterViewInit(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.fetchInitialNotifications(),this.notifications.start(this.splitView),this.cronObserver=s.b.on(d.b.READ_CRON_EVENT,(()=>{this.isCurrentView&&this.refreshNotifications()}),m.b.getCurrentSiteId()),this.pushObserver=g.a.on("receive").subscribe((i=>{if(!this.isCurrentView)return this.pendingRefresh=!0,void 0;r.a.isTrueOrOne(i.notif)&&m.b.isCurrentSite(i.site)&&this.refreshNotifications()})),this.readObserver=s.b.on(d.b.READ_CHANGED_EVENT,(i=>{if(!i.id)return;const t=this.notifications.items.find((t=>t.id===i.id));t&&(t.read=!0,t.timeread=i.time,this.loadMarkAllAsReadButton())}));(new p.a).treatLink()}))}fetchNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){i?yield this.notifications.reload():yield this.notifications.load(),this.fetchMoreNotificationsFailed=!1,this.loadMarkAllAsReadButton()}))}fetchInitialNotifications(){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.fetchNotifications(!0)}catch(i){c.a.showErrorModalDefault(i,"Error loading notifications"),this.notifications.reset()}}))}fetchMoreNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.fetchNotifications(!1)}catch(i){c.a.showErrorModalDefault(i,"Error loading more notifications"),this.fetchMoreNotificationsFailed=!0}i()}))}markAllNotificationsAsRead(){return Object(a.a)(this,void 0,void 0,(function*(){this.loadingMarkAllNotificationsAsRead=!0,yield r.a.ignoreErrors(d.a.markAllNotificationsAsRead()),s.b.trigger(d.b.READ_CHANGED_EVENT,{time:u.a.timestamp()},m.b.getCurrentSiteId()),yield this.refreshNotifications()}))}loadMarkAllAsReadButton(){return Object(a.a)(this,void 0,void 0,(function*(){try{this.loadingMarkAllNotificationsAsRead=!0;const i=yield d.a.getUnreadNotificationsCount();this.canMarkAllNotificationsAsRead=i.count>0}finally{this.loadingMarkAllNotificationsAsRead=!1}}))}refreshNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){yield r.a.ignoreErrors(d.a.invalidateNotificationsList()),yield r.a.ignoreErrors(this.fetchNotifications(!0)),null==i||i.complete()}))}ionViewDidEnter(){this.isCurrentView=!0,this.pendingRefresh&&(this.pendingRefresh=!1,this.refreshNotifications())}ionViewDidLeave(){this.isCurrentView=!1}ngOnDestroy(){var i,t,n,o;null===(i=this.cronObserver)||void 0===i?void 0:i.off(),null===(t=this.readObserver)||void 0===t||t.off(),null===(n=this.pushObserver)||void 0===n||n.unsubscribe(),null===(o=this.notifications)||void 0===o||o.destroy()}}return AddonNotificationsListPage.ɵfac=function AddonNotificationsListPage_Factory(i){return new(i||AddonNotificationsListPage)},AddonNotificationsListPage.ɵcmp=P.sc({type:AddonNotificationsListPage,selectors:[["page-addon-notifications-list"]],viewQuery:function AddonNotificationsListPage_Query(i,t){var n;(1&i&&P.ud(_.a,!0),2&i)&&(P.dd(n=P.Nc())&&(t.splitView=n.first))},decls:22,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap","button","","lines","full",3,"detail","click",4,"ngFor","ngForOf"],["icon","far-bell",3,"message",4,"ngIf"],[3,"enabled","error","action"],["slot","fixed","collapsible-footer","","appearOnBottom","",1,"mark-all-as-read"],["color","primary",3,"disabled","click",4,"ngIf"],["button","","lines","full",1,"ion-text-wrap",3,"detail","click"],["slot","start",3,"user","profileUrl","fullname","userId",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId","wsNotFiltered"],["slot","end",4,"ngIf"],["slot","start",3,"user","profileUrl","fullname","userId"],["class","core-avatar-extra-img",4,"ngIf"],[3,"modicon","modname","showAlt",4,"ngIf"],[1,"core-avatar-extra-img"],["alt","","role","presentation",3,"src"],[3,"modicon","modname","showAlt"],["class","core-notification-icon","slot","start",4,"ngIf"],["class","core-notification-icon","slot","start",3,"modicon","modname","showAlt",4,"ngIf"],["slot","start",1,"core-notification-icon"],["slot","start",1,"core-notification-icon",3,"modicon","modname","showAlt"],["name","fas-circle","color","primary","aria-hidden","true"],["icon","far-bell",3,"message"],["color","primary",3,"disabled","click"],["name","fas-eye","aria-hidden","true",4,"ngIf"],["name","fas-eye","aria-hidden","true"]],template:function AddonNotificationsListPage_Template(i,t){1&i&&(P.Ec(0,"ion-header"),P.Ec(1,"ion-toolbar"),P.Ec(2,"ion-buttons",0),P.zc(3,"ion-back-button",1),P.Pc(4,"translate"),P.Dc(),P.Ec(5,"ion-title"),P.Ec(6,"h1"),P.pd(7),P.Pc(8,"translate"),P.Dc(),P.Dc(),P.Ec(9,"ion-buttons",2),P.zc(10,"core-user-menu-button"),P.Dc(),P.Dc(),P.Dc(),P.Ec(11,"ion-content"),P.Ec(12,"core-split-view"),P.Ec(13,"ion-refresher",3),P.Mc("ionRefresh",(function AddonNotificationsListPage_Template_ion_refresher_ionRefresh_13_listener(i){return t.refreshNotifications(i.target)})),P.zc(14,"ion-refresher-content",4),P.Pc(15,"translate"),P.Dc(),P.Ec(16,"core-loading",5),P.nd(17,AddonNotificationsListPage_ion_item_17_Template,12,18,"ion-item",6),P.nd(18,AddonNotificationsListPage_core_empty_box_18_Template,2,3,"core-empty-box",7),P.Ec(19,"core-infinite-loading",8),P.Mc("action",(function AddonNotificationsListPage_Template_core_infinite_loading_action_19_listener(i){return t.fetchMoreNotifications(i)})),P.Dc(),P.Dc(),P.Ec(20,"div",9),P.nd(21,AddonNotificationsListPage_ion_chip_21_Template,5,6,"ion-chip",10),P.Dc(),P.Dc(),P.Dc()),2&i&&(P.lc(3),P.Vc("text",P.Qc(4,10,"core.back")),P.lc(4),P.qd(P.Qc(8,12,"addon.notifications.notifications")),P.lc(6),P.Vc("disabled",!t.notifications.loaded),P.lc(1),P.Wc("pullingText",P.Qc(15,14,"core.pulltorefresh")),P.lc(2),P.Vc("hideUntil",t.notifications.loaded),P.lc(1),P.Vc("ngForOf",t.notifications.items),P.lc(1),P.Vc("ngIf",!t.notifications||t.notifications.empty),P.lc(1),P.Vc("enabled",t.notifications.loaded&&!t.notifications.completed)("error",t.fetchMoreNotificationsFailed),P.lc(2),P.Vc("ngIf",t.notifications.loaded&&t.canMarkAllNotificationsAsRead))},directives:[A.C,A.Ab,A.m,A.h,A.i,A.yb,v.a,N.a,A.v,_.a,A.bb,A.cb,M.a,O.s,O.t,x.a,C.a,A.I,A.O,w.a,k.a,L.a,A.W,A.D,y.a,E.a,A.t,A.qb],pipes:[T.d,V.a],styles:["ion-item[_ngcontent-%COMP%]{--icon-size:16px;--extra-icon-size:12px;--core-avatar-size:32px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{font-size:var(--text-size);-webkit-line-clamp:3;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;display:-webkit-box}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin:0;padding-left:8px;padding-right:0;padding-top:12px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{padding-left:unset;padding-right:unset;-webkit-padding-start:8px;padding-inline-start:8px;-webkit-padding-end:0;padding-inline-end:0}}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:6px;vertical-align:middle}ion-item[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{align-self:start;margin-top:16px}ion-item[_ngcontent-%COMP%]   core-mod-icon.core-notification-icon[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:8px;max-width:var(--core-avatar-size);max-height:var(--core-avatar-size)}.mark-all-as-read[_ngcontent-%COMP%]{padding-bottom:16px;bottom:0;left:0;right:0;display:flex;background:transparent;box-shadow:none;pointer-events:none}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]{pointer-events:all;margin:0 auto;box-shadow:0 2px 4px rgba(0,0,0,.4)}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:16px;height:16px;margin-left:0;margin-right:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:44px}","[_nghost-%COMP%]{--extra-icon-size:16px;--icon-size:24px}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img, [_nghost-%COMP%]     core-user-avatar core-mod-icon{margin:0!important;position:absolute;right:-4px;bottom:-4px;padding:.2rem}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img{background:var(--background-color);border-radius:var(--medium-radius)}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img img{max-width:var(--extra-icon-size);max-height:var(--extra-icon-size);display:block}[_nghost-%COMP%]     core-user-avatar core-mod-icon{--size:var(--extra-icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:.7rem;background:var(--background-color);border-radius:var(--small-radius)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:var(--icon-size);height:var(--icon-size)}[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{--module-icon-size:var(--icon-size);margin:6px 8px 6px 0}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}"]}),AddonNotificationsListPage})();var z=n("dQ3M"),D=n("vY5A"),R=n("Y+03");const F=[{path:"",component:I,children:Object(D.c)([{path:":id",loadChildren:()=>n.e(11).then(n.bind(null,"csSw")).then((i=>i.AddonNotificationsNotificationPageModule))}],(()=>R.a.isTablet))}];let j=(()=>{class AddonNotificationsListPageModule{}return AddonNotificationsListPageModule.ɵmod=P.wc({type:AddonNotificationsListPageModule}),AddonNotificationsListPageModule.ɵinj=P.vc({factory:function AddonNotificationsListPageModule_Factory(i){return new(i||AddonNotificationsListPageModule)},imports:[[o.m.forChild(F),e.a,z.a],o.m]}),AddonNotificationsListPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&P.kd(j,{declarations:[I],imports:[o.m,e.a,z.a],exports:[o.m]}))}}]);